@startuml TC_LOGIN_001
title Sequence Diagram Test: TC_LOGIN_001 - Đăng nhập thành công với credentials hợp lệ

autonumber

actor "Tester" as tester

participant testClass as ":AuthServiceTest"
participant authService as ":AuthService"
participant fakeUserRepo as ":FakeUserRepository"
participant fakePasswordEncoder as ":FakePasswordEncoder"
participant fakeJwtProvider as ":FakeJwtTokenProvider"

note left of tester
    Unit Test: Kiểm tra đăng nhập
    thành công với username và
    password hợp lệ
end note

== Arrange ==

tester -> testClass : testLoginSuccess()
activate testClass

testClass -> testClass : loginRequest = new LoginRequest("hyan123", "password123")

== Action ==

testClass -> authService : authenticate(loginRequest: LoginRequest)
activate authService

authService -> fakeUserRepo : findByUsername("hyan123")
activate fakeUserRepo

note left of fakeUserRepo
    Fake data: username "hyan123" tồn tại
    với password "password123_encoded"
end note

fakeUserRepo --> authService : Optional.of(fakeUser)
deactivate fakeUserRepo

authService -> fakePasswordEncoder : matches("password123", "password123_encoded")
activate fakePasswordEncoder

note left of fakePasswordEncoder
    Fake logic: rawPassword + "_encoded" == encodedPassword
    "password123_encoded" == "password123_encoded" → true
end note

fakePasswordEncoder --> authService : true
deactivate fakePasswordEncoder

authService -> fakeJwtProvider : generateToken("hyan123")
activate fakeJwtProvider
fakeJwtProvider --> authService : "fake-jwt-token-2k5"
deactivate fakeJwtProvider

authService --> testClass : LoginResponse(success=true, message, token, userResponse)
deactivate authService

== Assert ==

testClass -> testClass : assertTrue(response.isSuccess())
testClass -> testClass : assertEquals("Đăng nhập thành công", response.getMessage())
testClass -> testClass : assertEquals("fake-jwt-token-2k5", response.getToken())
testClass -> testClass : assertNotNull(response.getUserResponse())
testClass -> testClass : assertEquals("hyan123", response.getUserResponse().getUsername())

alt Basic Flow: Tất cả assertions pass
    testClass --> tester : ✅ Test PASSED
else Exception Flow: Assertion failed
    testClass --> tester : ❌ Test FAILED
end

deactivate testClass

@enduml
