@startuml TC_LOGIN_005
title Sequence Diagram Test: TC_LOGIN_005 - Lỗi khi header xác thực bị thiếu

autonumber

actor "Tester" as tester

participant testClass as ":AuthServiceTest"
participant authService as ":AuthService"

note left of tester
    Unit Test: Kiểm tra lỗi khi
    Authorization header là null
end note

== Arrange ==

tester -> testClass : testGetCurrentUserHeaderNull()
activate testClass

note left of testClass
    Không có header xác thực
    authorizationHeader = null
end note

== Action ==

testClass -> testClass : assertThrows(AuthException.class, () -> {...})
activate testClass

testClass -> authService : getCurrentUser(null)
activate authService

authService -> authService : kiểm tra authorizationHeader == null
note left
    authorizationHeader == null → true
    hoặc không bắt đầu bằng "Bearer "
end note

authService --> testClass : throw AuthException("Thiếu header xác thực", UNAUTHORIZED)
deactivate authService

deactivate testClass

== Assert ==

testClass -> testClass : assertEquals("Thiếu header xác thực", exception.getMessage())

alt Basic Flow: AuthException được ném và message đúng
    testClass --> tester : ✅ Test PASSED
else Exception Flow: Không có exception hoặc message sai
    testClass --> tester : ❌ Test FAILED
end

deactivate testClass

@enduml
